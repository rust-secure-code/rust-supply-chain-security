<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Manage dependencies - Rust Supply Chain Security Guide</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="A guide to securing the software supply chain of Rust programs and libraries">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="dependencies.html" class="active"><strong aria-hidden="true">1.</strong> Manage dependencies</a></li><li class="chapter-item expanded "><a href="maintain.html"><strong aria-hidden="true">2.</strong> Maintain a crate</a></li><li class="chapter-item expanded "><a href="build.html"><strong aria-hidden="true">3.</strong> Build for production</a></li><li class="chapter-item expanded "><a href="run.html"><strong aria-hidden="true">4.</strong> Run in production</a></li><li class="chapter-item expanded affix "><a href="checklist.html">Checklist</a></li><li class="chapter-item expanded affix "><a href="links.html">External links</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust Supply Chain Security Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/amousset/rust-supply-chain-security" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/amousset/rust-supply-chain-security/edit/main/src/dependencies.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="manage-dependencies"><a class="header" href="#manage-dependencies">Manage dependencies</a></h1>
<p><code>cargo</code> makes it really easy to use dependencies, so the programs in the Rust ecosystem tend
to use a lot of them.
Despite the obvious advantages for the developers, this also comes with
specific risks.
Let's start by describing them, either direct or somewhere in the dependency tree.</p>
<p>The most common risk is the presence of vulnerabilities in one of the dependencies,
like <a href="https://en.wikipedia.org/wiki/Log4Shell">Log4Shell</a> in the Java <code>log4j</code> logging library,
containing an exploitable remote code execution.</p>
<p>The other main risk is an intentional attack introducing malicious behavior (advertising, attacking developer systems,
compromising<a href="dependencies.html">dependencies.md</a> build systems, introducing backdoor in final products, etc.) in the 
dependency tree.
There are several possible kinds of malicious crates:</p>
<ul>
<li>
<p>New crates which look like legitimate ones.
Frequently using a name close to a widely used one (called typosquatting).</p>
<ul>
<li>Such an incident already happened with the <a href="https://blog.rust-lang.org/2022/05/10/malicious-crate-rustdecimal.html">rustdecimal</a>
crate, masquerading as the legitimate <code>rust_decimal</code> crate.
It contained a payload targeting Gitlab CI.</li>
</ul>
</li>
<li>
<p>New versions of legitimate crates, either by stealing credentials or
gaining publication access.</p>
</li>
</ul>
<p>For now the Rust ecosystem has been relatively preserved for these attacks, but it's likely
linked to the lower visibility and popularity (compared to <code>npm.org</code> for example),
and not to intrinsic differences in the tooling or usage.</p>
<h2 id="choose-dependencies"><a class="header" href="#choose-dependencies">Choose dependencies</a></h2>
<h3 id="DEPS-FEATURES"><a class="header" href="#DEPS-FEATURES">Minimize dependencies (DEPS-FEATURES)</a></h3>
<p>The safest dependency is the one you don't include.
Be careful though, the number of dependencies is not always a good measurement of the attack surface
(several crates maintained by the same team don't really multiply the risk).
To get an overview of people and organizations with publish access to your dependencies,
you can use the <a href="https://github.com/rust-secure-code/cargo-supply-chain">cargo supply-chain</a> tool:</p>
<pre><code class="language-shell">The following individuals can publish updates for your dependencies:

 1. alexcrichton via crates: bitflags, [...], web-sys
[...]
 139. zrzka via crates: anes

Note: there may be outstanding publisher invitations. crates.io provides no way to list them.
See https://github.com/rust-lang/crates.io/issues/2868 for more info.

All members of the following teams can publish updates for your dependencies:

 1. &quot;github:rust-bus:maintainers&quot; (https://github.com/rust-bus) via crates: [...]
[...]
 35. &quot;github:tower-rs:publish&quot; (https://github.com/tower-rs) via crates: tower-service

Github teams are black boxes. It's impossible to get the member list without explicit permission.
</code></pre>
<p>In order to minimize the number of dependencies, and your attack surface, you can:</p>
<ul>
<li>Explore your dependency tree with <code>cargo tree</code>/<code>cargo supply-chain</code> to see if you spot something to remove</li>
<li>Minimizing the dependency features.
Crates tend to include a lot of features by default for convenience,</li>
<li>but you can usually remove a part of the dependencies by disabling default features and only selecting the ones you actually need.</li>
</ul>
<pre><code class="language-toml">mylibrary = { version = &quot;1&quot;, default-features = false, features = [ &quot;required-feature&quot; ] }
</code></pre>
<h3 id="DEPS-ASSESS"><a class="header" href="#DEPS-ASSESS">Assess a dependency (DEPS-ASSESS)</a></h3>
<p>There is a <a href="https://gist.github.com/repi/d98bf9c202ec567fd67ef9e31152f43f">very good checklist</a>
covering many aspects of crate evaluation published (and used internally) by <a href="https://www.embark-studios.com/">Embark</a>.</p>
<p>When considering adding a dependency, there are a few things
you can do to lower the different risks.
Auditing the code is always an option, but is not scalable, especially including all future version upgrades.
There are several initiatives intending to share the review
work in the community,
like <a href="https://github.com/crev-dev/cargo-crev"><code>cargo-crev</code></a> and <a href="https://mozilla.github.io/cargo-vet/"><code>cargo-vet</code></a>.</p>
<p>Note: When reviewing a crate, don't use the repository as a reference as it may diverge
from the content uploaded to crates.io.
Instead, you can download the crate (using URLs like: https://crates.io/api/v1/crates/serde/1.0.0/download),
use the source view on docs.rs (or an external service like <a href="https://sourcegraph.com/search">Sourcegraph</a>
(<a href="https://sourcegraph.com/crates/regex@v1.1.0/-/blob/src/compile.rs">example</a>),
used by <code>cargo vet</code> for reviews, which is more convenient for comparing versions).</p>
<p>Note: Be careful when opening untrusted crates in your editor/IDE,
as even only opening it can run arbitrary code in procedural macros.
Use a simple text editor (without LSP-like features) or make use of
features like the <a href="https://code.visualstudio.com/docs/editor/workspace-trust">restricted mode</a> in VSCode.</p>
<p>To prevent potential vulnerabilities in memory management,
a focus on <code>unsafe</code> code is often needed in code reviews.
Tooling like <a href="https://github.com/rust-secure-code/cargo-geiger"><code>cargo-geiger</code></a> can help
track the use of unsafe code in dependencies.</p>
<h3 id="DEPS-VET"><a class="header" href="#DEPS-VET">Assess dependencies with <code>cargo vet</code> (DEPS-VET)</a></h3>
<p><code>cargo vet</code> is a project started by Mozilla
(and now also <a href="https://opensource.googleblog.com/2023/05/open-sourcing-our-rust-crate-audits.html">used by Google</a>)
to formalize crate audits in an organization, and be able to share
these with the community.</p>
<p>As this topic is all a matter of trust, by default <code>cargo vet</code> works with local audits
you make yourselves.
You can also <a href="https://mozilla.github.io/cargo-vet/importing-audits.html">import audit results</a>
from selected sources you trust, in the form of a git repository
URL. There is no centralized data source nor default trusted source.</p>
<pre><code class="language-toml">[imports.mozilla]
url = &quot;https://raw.githubusercontent.com/mozilla/supply-chain/main/audits.toml&quot;

[imports.google]
url = &quot;https://raw.githubusercontent.com/google/supply-chain/main/audits.toml&quot;
</code></pre>
<p>You can also <a href="https://mozilla.github.io/cargo-vet/trusting-publishers.html">trust specific publishers</a>.
This lowers the level of scrutiny (as it does not protect against some threats)
but allows focusing on more risky packages.</p>
<h2 id="maintain-dependencies-over-time"><a class="header" href="#maintain-dependencies-over-time">Maintain dependencies over time</a></h2>
<p>Once you have chosen to use a dependency, you need to keep track of it
over time.</p>
<h3 id="DEPS-VULNS"><a class="header" href="#DEPS-VULNS">Vulnerability and maintenance check (DEPS-VULNS)</a></h3>
<p>You should also monitor for vulnerabilities and unmaintained crates using <code>cargo audit</code> or <code>cargo deny</code> regularly
(e.g. with a daily CI job).
<a href="https://github.blog/2022-06-06-github-brings-supply-chain-security-features-to-the-rust-community/">GitHub's tooling</a>
can also help
track security vulnerabilities in your project.</p>
<h3 id="DEPS-UPDATES"><a class="header" href="#DEPS-UPDATES">Regular updates (DEPS-UPDATES)</a></h3>
<p>You should also try to stay up to date; this helps get bug fixes and improvements,
and also avoids using unmaintained versions,
ensuring to get easy access to security fixes in case of security vulnerability.
Use <a href="https://github.com/kbknapp/cargo-outdated"><code>cargo outdated</code></a> to show possible updates.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="introduction.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="maintain.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="introduction.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="maintain.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
