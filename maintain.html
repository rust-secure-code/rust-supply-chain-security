<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Maintain a crate - Rust Supply Chain Security Guide</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="A guide to securing the software supply chain of Rust programs and libraries">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="dependencies.html"><strong aria-hidden="true">1.</strong> Manage dependencies</a></li><li class="chapter-item expanded "><a href="maintain.html" class="active"><strong aria-hidden="true">2.</strong> Maintain a crate</a></li><li class="chapter-item expanded "><a href="build.html"><strong aria-hidden="true">3.</strong> Build for production</a></li><li class="chapter-item expanded "><a href="run.html"><strong aria-hidden="true">4.</strong> Run in production</a></li><li class="chapter-item expanded affix "><a href="checklist.html">Checklist</a></li><li class="chapter-item expanded affix "><a href="links.html">External links</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust Supply Chain Security Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-secure-code/rust-supply-chain-security" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-secure-code/rust-supply-chain-security/edit/main/src/maintain.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="maintaining-a-crate"><a class="header" href="#maintaining-a-crate">Maintaining a crate</a></h1>
<p>This page contains the items related to crate maintenance, especially when
you intend to make your crate public.
An obvious risk is a takeover of the crate, for example, on the crates.io repository,
in order to publish malicious versions of your crate.
It is also important to help your consumers (library or binary program users)
tu secure their own supply chain.</p>
<h2 id="include-necessary-information-to-make-the-builds-consistent"><a class="header" href="#include-necessary-information-to-make-the-builds-consistent">Include necessary information to make the builds consistent</a></h2>
<h3 id="MAINTAIN-LOCK"><a class="header" href="#MAINTAIN-LOCK">Include <code>Cargo.lock</code> in sources (MAINTAIN-LOCK)</a></h3>
<p>If you develop a binary program, it is important to commit the <code>Cargo.lock</code> file in your repository.
This will help keep track of the exact versions used and ensure consistent and (mostly) reproducible builds.</p>
<h3 id="MAINTAIN-TOOLCHAIN"><a class="header" href="#MAINTAIN-TOOLCHAIN">Include <code>rust-toolchain.toml</code> in sources (MAINTAIN-TOOLCHAIN)</a></h3>
<p>In the same spirit, providing the Rust version to use in a <a href="https://rust-lang.github.io/rustup/overrides.html#the-toolchain-file"><code>rust-toolchain.toml</code> file</a>
in your binary program sources allows ensuring all builds will use a consistent toolchain version.</p>
<pre><code class="language-toml">[toolchain]
channel = &quot;1.71.0&quot;
</code></pre>
<h2 id="MAINTAIN-FEATURES"><a class="header" href="#MAINTAIN-FEATURES">Fine-grained features (MAINTAIN-FEATURES)</a></h2>
<p>Allow users of the crate to control transitive dependencies depending on their 
needs, using features.
You can still define complete default features including
broad use cases for convenience.</p>
<h2 id="maintaining-a--sys-crate-building-cc-code"><a class="header" href="#maintaining-a--sys-crate-building-cc-code">Maintaining a <code>-sys</code> crate building C/C++ code</a></h2>
<p>Some crates which provide bindings for a C or C++ library (<a href="https://doc.rust-lang.org/cargo/reference/build-scripts.html#-sys-packages"><code>-sys</code> crates</a>) are also able to compile
the library statically into the Rust binary. It is convenient but should be</p>
<h3 id="MAINTAIN-SRCFLAG"><a class="header" href="#MAINTAIN-SRCFLAG">Provide flags allowing to select the behavior (MAINTAIN-SRCFLAG)</a></h3>
<p>Users need to be able to be sure of the outcome of the build, whether they want to always
embed the library statically, or enforce dynamic linking and make the build fail
if it is missing.
A clear way to express this is to do dynamic linking by default
and provide a flag (<code>vendored</code> or similar) to choose to embed the library.</p>
<p>If the default behavior is to embed the library from the crate if missing on the system for convenience,
then it should be documented clearly.</p>
<h3 id="MAINTAIN-SRCCRATE"><a class="header" href="#MAINTAIN-SRCCRATE">Use a dedicated crate if possible (MAINTAIN-SRCCRATE)</a></h3>
<p>Instead of building the static library directly in the <code>-sys</code> crate, a good practice is
to use a dedicated crate for this purpose (like <code>openssl-sys</code> and <code>openssl-src</code>).
In this case, you can add the upstream version to the source crate version by using the build version defined in SemVer (defined as MAJOR.MINOR.PATCH+BUILD). For example, for openssl-src it gives <code>111.16.0+1.1.1l</code>, <code>1.1.1l</code> being the upstream packaged version.</p>
<p>This allows making the presence of the embedded library visible in the cargo tooling
(cargo tree, etc.), and more specifically to get security advisories for the embedded
component through the usual channels (<code>cargo audit/deny</code>).
This also allows
correctly documenting the upstream code license separately from the Rust crate.</p>
<h2 id="MAINTAIN-VULNS"><a class="header" href="#MAINTAIN-VULNS">Reporting vulnerabilities (MAINTAIN-VULNS)</a></h2>
<p>If you find a vulnerability affecting your crate,
<a href="https://rustsec.org/contributing.html">reporting it to the RustSec advisory database</a> will get
your users warned if they use
any kind of vulnerability detection on their dependencies.
Reporting to RustSec only is enough, as the advisories will get imported
by GitHub into their advisory own database (allowing alerts and pull requests by <em>dependabot</em> for example),
and assigned a CVE when relevant.</p>
<p>Note: RustSec is only a database for (public) vulnerabilities affecting crates.
For everything related to the Rust toolchain, infrastructure, etc. or
if you need confidentiality, you need to
contact the security response team as per the
<a href="https://www.rust-lang.org/policies/security">official security policy</a> at <a href="mailto:security@rust-lang.org">security@rust-lang.org</a>.</p>
<h2 id="publication-on-cratesio"><a class="header" href="#publication-on-cratesio">Publication on crates.io</a></h2>
<p>When using crates.io for publishing your crates, you need to be careful about a few things.</p>
<h3 id="MAINTAIN-CRATESIO2FA"><a class="header" href="#MAINTAIN-CRATESIO2FA">GitHub account with 2FA enabled (MAINTAIN-CRATESIO2FA)</a></h3>
<p>As crates.io uses GitHub as authentication layer, you should first properly secure your account using general best practices.
In particular,
make sure to have <a href="https://github.com/settings/security">two-factor authentication layer configured</a>
(and avoid the SMS/Text message method).</p>
<h3 id="MAINTAIN-CRATESIOTKN"><a class="header" href="#MAINTAIN-CRATESIOTKN">crates.io token configuration (MAINTAIN-CRATESIOTKN)</a></h3>
<p>Apart from the Web interface, the other way to interact with crates.io is through its
HTTP API,
especially through cargo commands (<code>cargo publish</code>, etc.)
that can run on the developer machine or on CI/CD systems, to automate publication. 
These interactions are authenticated using a token created in the Web interface.</p>
<p>You should crate a unique token for each use-case, and give it a minimal 
set of permissions. Setting an expiration date allows forcing a regular rotation of tokens. For a one-shot operation, set a one-day validity or even revoke the token just after usage.
If you had tokens crated before token scopes were introduced,
you should delete them and recreate more restricted ones.</p>
<p>When using this token in an automated context, it should be stored securely (e.g.
as an <a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets">encrypted secret</a> in GitHub)
and passed as the
<a href="https://doc.rust-lang.org/cargo/reference/config.html?highlight=CARGO_REGISTRY_TOKEN#credentials"><code>CARGO_REGISTRY_TOKEN</code></a> environment variable.</p>
<p><img src="images/token.png" alt="New token form on crates.io" /></p>
<h2 id="MAINTAIN-CODESEC"><a class="header" href="#MAINTAIN-CODESEC">Code security best practices (MAINTAIN-CODESEC)</a></h2>
<p>Apply security best practices to your code and tests, like <a href="https://rust-fuzz.github.io/book/introduction.html">fuzzing</a>,
testing using <a href="https://github.com/rust-lang/miri">miri</a>, etc.
You can learn more in the <a href="https://highassurance.rs/">High Assurance Rust</a> book.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="dependencies.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="build.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="dependencies.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="build.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
